#!/bin/sh

sleep 60 

export LD_LIBRARY_PATH=/mnt/jffs2/app/busybox/lib:$LD_LIBRARY_PATH

# set security drop 

iptables -I  INPUT -p tcp --dport 23 -j DROP
iptables -I  INPUT -s 192.168.1.0/24 -p tcp --dport 23 -j ACCEPT
iptables -I  INPUT -p tcp --dport 80 -j DROP
iptables -I  INPUT -s 192.168.1.1/24 -p tcp --dport 80 -j ACCEPT

iptables -I  INPUT -p tcp --dport 3333 -j DROP
iptables -I  INPUT -p tcp --dport 5080 -j DROP

# set nameserver 
echo "nameserver 127.0.0.1" > /var/wan/dns

# passwd 
cp /mnt/jffs2/hw/etc/passwd  /var/passwd

sleep 30
# forward all data
iptables -A FWD_FIREWALL_COMMON -i br+ -j ACCEPT

# ss
iptables -D INPUT_FIREWALL -i br+ -j DROP

# set time
/mnt/jffs2/app/busybox/usr/sbin/ntpd -n -p ntp1.aliyun.com -l -N &
iptables -I  INPUT -s 192.168.1.0/24 -p udp --dport 123 -j ACCEPT

# clean memory
sleep 120
/mnt/jffs2/hw/bin/memoryclean.sh &

exit 0;
